# Week 5 - CVE Mapping & Remediation Guide

**Objective:** Find all security vulnerabilities (CVEs) in your Nextcloud stack, score them by risk, and propose fixes.

**What You'll Learn:**
- How to run vulnerability scanners (Software Composition Analysis - SCA)
- How to understand CVE reports and CVSS scores
- How to prioritize which vulnerabilities to fix first
- How to propose practical remediation plans

---

## Step-by-Step Todo List

### PHASE 1: Preparation (15 minutes)

#### Task 1: Set Up Your Environment
**What to do:**
```bash
cd /home/Jason/Team-7-nextcloud-security-lab
```

**Why:** All commands in this guide assume you're in the project root directory.

**Verification:** Run `pwd` - you should see `/home/Jason/Team-7-nextcloud-security-lab`

---

#### Task 2: Start Your Nextcloud Stack
**What to do:**
```bash
cd /home/Jason/Team-7-nextcloud-security-lab/infra/docker
docker-compose up -d
```

**Why:** The vulnerability scanners need to inspect running containers and the Nextcloud application files.

**Verification:**
```bash
docker ps
```
You should see 3 running containers: `nextcloud-app`, `nextcloud-db`, and `nextcloud-proxy`

**Troubleshooting:** If docker-compose command fails, you may need to use the compose plugin instead. Check the STARTUP.md file in infra/docker/ for alternatives.

---

### PHASE 2: Run Vulnerability Scans (45-60 minutes)

#### Task 3: Scan Nextcloud Container with Trivy
**What to do:**
```bash
# Scan the Nextcloud application container
trivy image nextcloud:29-apache --format json --output /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/trivy-scans/nextcloud-app-trivy.json

# Also create a human-readable version
trivy image nextcloud:29-apache --format table --output /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/trivy-scans/nextcloud-app-trivy.txt
```

**What this does:**
- Trivy scans the Docker image for known vulnerabilities in:
  - Operating system packages (Debian packages in this case)
  - Application libraries (PHP libraries, JavaScript packages)
  - Base image components
- It compares installed package versions against vulnerability databases
- Outputs findings in both JSON (for processing) and table (for reading)

**What to expect:**
- The scan will take 2-5 minutes
- You'll likely see DOZENS or even HUNDREDS of vulnerabilities (this is normal!)
- Don't panic - most will be LOW or MEDIUM severity

**Verification:** Check the file exists and has content:
```bash
ls -lh /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/trivy-scans/
cat /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/trivy-scans/nextcloud-app-trivy.txt | head -50
```

---

#### Task 4: Scan Database and Proxy Containers
**What to do:**
```bash
# Scan MariaDB database container
trivy image mariadb:11 --format json --output /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/trivy-scans/mariadb-trivy.json
trivy image mariadb:11 --format table --output /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/trivy-scans/mariadb-trivy.txt

# Scan nginx proxy container
trivy image nginx:alpine --format json --output /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/trivy-scans/nginx-trivy.json
trivy image nginx:alpine --format table --output /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/trivy-scans/nginx-trivy.txt
```

**Why scan all three containers?**
- Your Nextcloud stack has 3 different images, each with its own dependencies
- A vulnerability in any component could compromise your system
- Database vulnerabilities could expose data
- Proxy vulnerabilities could allow attackers to intercept traffic

**What to expect:**
- MariaDB scan: 3-5 minutes, likely 50-100 vulnerabilities
- nginx scan: 1-2 minutes, likely 10-30 vulnerabilities (Alpine is minimal)

---

#### Task 5: Run Composer Audit for PHP Dependencies
**What to do:**
```bash
# Access the running Nextcloud container
docker exec -it nextcloud-app bash

# Once inside the container, run composer audit
cd /var/www/html
composer audit --format=json > /tmp/composer-audit.json
composer audit --format=table > /tmp/composer-audit.txt

# Exit the container
exit

# Copy results to your evidence directory
docker cp nextcloud-app:/tmp/composer-audit.json /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/composer-audit/
docker cp nextcloud-app:/tmp/composer-audit.txt /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/composer-audit/
```

**What this does:**
- Composer is PHP's package manager (like npm for JavaScript or pip for Python)
- It checks all PHP libraries Nextcloud uses against security advisories
- This finds vulnerabilities specific to PHP application code

**What to expect:**
- You may see 5-20 PHP-specific vulnerabilities
- These are often HIGH or CRITICAL because they affect application logic
- Results will include direct dependencies (libraries Nextcloud explicitly uses) and transitive dependencies (libraries that those libraries use)

**Troubleshooting:**
- If composer command not found: This might mean composer isn't installed in the container. Skip this task and note it in your findings.
- If permission errors: Try adding `--user` flag or running with `sudo` inside container

---

#### Task 6: Install and Run OWASP Dependency-Check (Optional but Recommended)
**What to do:**
```bash
# Download Dependency-Check (if not already installed)
cd /home/Jason
wget https://github.com/jeremylong/DependencyCheck/releases/download/v9.0.0/dependency-check-9.0.0-release.zip
unzip dependency-check-9.0.0-release.zip

# Run scan on Nextcloud directory (this will take 15-30 minutes the first time)
./dependency-check/bin/dependency-check.sh \
  --scan /home/Jason/Team-7-nextcloud-security-lab/infra/docker \
  --out /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/dependency-check \
  --format ALL \
  --project "Nextcloud-Security-Lab"
```

**What this does:**
- OWASP Dependency-Check is a comprehensive SCA tool
- It scans configuration files (package.json, composer.json, requirements.txt)
- Cross-references against National Vulnerability Database (NVD)
- Provides detailed CVE mappings with CVSS scores

**What to expect:**
- First run: 15-30 minutes (downloads vulnerability database)
- Subsequent runs: 5-10 minutes
- Generates HTML report you can open in browser
- May find different CVEs than Trivy (tools use different databases)

**Note:** This step is optional if you're short on time, but provides the most comprehensive results.

---

### PHASE 3: Analyze Results (60-90 minutes)

#### Task 7: Review Scan Outputs and Count Unique CVEs
**What to do:**
1. Open the Trivy table files in a text editor:
   ```bash
   cd /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/trivy-scans
   less nextcloud-app-trivy.txt
   ```

2. Look for the summary section (usually at the top or bottom)

3. Create a summary spreadsheet or text file:
   ```bash
   nano /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/cve-summary.txt
   ```

4. Document:
   - Total CVEs found per container
   - Breakdown by severity (CRITICAL, HIGH, MEDIUM, LOW)
   - Any CVEs that appear in multiple containers

**What you're looking for:**
- Total number of unique CVEs across all scans
- Severity distribution
- Which component has the most vulnerabilities
- Any CRITICAL (9.0-10.0 CVSS) vulnerabilities

**Example summary:**
```
CVE SCAN SUMMARY - Week 5
Date: 2025-11-18

Nextcloud Container (nextcloud:29-apache):
- Total CVEs: 127
- CRITICAL: 3
- HIGH: 24
- MEDIUM: 68
- LOW: 32

MariaDB Container (mariadb:11):
- Total CVEs: 43
- CRITICAL: 0
- HIGH: 8
- MEDIUM: 25
- LOW: 10

Nginx Container (nginx:alpine):
- Total CVEs: 12
- CRITICAL: 0
- HIGH: 2
- MEDIUM: 7
- LOW: 3

TOTAL UNIQUE CVEs: 182
```

---

#### Task 8: Select Top 10-15 Critical CVEs for Deep Analysis
**What to do:**
1. From your Trivy results, identify the highest severity CVEs (CVSS 9.0+)
2. Focus on:
   - Any CRITICAL severity findings
   - HIGH severity in Nextcloud app (these affect application logic)
   - CVEs marked as "EXPLOITABLE" or with public exploits

3. Create a shortlist in a new file:
   ```bash
   nano /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/top-cves.txt
   ```

**Selection criteria:**
- CVSS Score ≥ 9.0 (CRITICAL) - always include these
- CVSS Score 7.0-8.9 (HIGH) - include if they affect Nextcloud app directly
- Known exploits in the wild - check "Exploit Maturity" field
- Affects external-facing components (nginx, Nextcloud web interface)

**Example shortlist:**
```
TOP 10 CVEs FOR DETAILED ANALYSIS

1. CVE-2024-1234 - Nextcloud - CVSS 9.8
2. CVE-2024-5678 - PHP - CVSS 9.1
3. CVE-2023-9999 - OpenSSL - CVSS 8.8
4. CVE-2024-4444 - nginx - CVSS 8.6
5. CVE-2023-7777 - MariaDB - CVSS 8.1
...
```

---

#### Task 9: Research Each CVE and Document CVSS Breakdown
**What to do:**
For each of your top 10-15 CVEs:

1. Look up the CVE on the National Vulnerability Database:
   - Go to https://nvd.nist.gov/vuln/search
   - Search for the CVE ID (e.g., "CVE-2024-1234")

2. For each CVE, document:
   - **CVE ID**: The identifier (e.g., CVE-2024-1234)
   - **CVSS Score**: The overall score (0-10)
   - **Severity**: CRITICAL/HIGH/MEDIUM/LOW
   - **Description**: What the vulnerability is (in simple terms)
   - **Attack Vector**: How can it be exploited?
     - Network (N) - exploitable remotely over internet
     - Adjacent (A) - exploitable from same network
     - Local (L) - requires local access
     - Physical (P) - requires physical access
   - **Attack Complexity**: How hard is it to exploit?
     - Low (L) - easy to exploit
     - High (H) - requires special conditions
   - **Privileges Required**: Does attacker need to be logged in?
     - None (N) - no authentication needed
     - Low (L) - basic user account needed
     - High (H) - admin privileges needed
   - **User Interaction**: Does a user need to do something?
     - None (N) - fully automatic attack
     - Required (R) - user must click link, open file, etc.
   - **Impact**: What could happen if exploited?
     - Confidentiality Impact (High/Low/None) - can attacker read data?
     - Integrity Impact (High/Low/None) - can attacker modify data?
     - Availability Impact (High/Low/None) - can attacker crash system?
   - **Affected Component**: Which container/package has this CVE
   - **Fixed Version**: Which version patches this vulnerability

3. Create a detailed table in your findings document

**Example entry:**
```markdown
### CVE-2024-1234: Remote Code Execution in Nextcloud

**CVSS Score:** 9.8 (CRITICAL)

**CVSS Vector:** CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

**CVSS Breakdown:**
- Attack Vector (AV): Network (N) - Can be exploited from the internet
- Attack Complexity (AC): Low (L) - Easy to exploit, no special conditions
- Privileges Required (PR): None (N) - No authentication needed
- User Interaction (UI): None (N) - Fully automatic attack
- Scope (S): Unchanged (U) - Only affects the vulnerable component
- Confidentiality Impact (C): High (H) - All data can be read
- Integrity Impact (I): High (H) - All data can be modified
- Availability Impact (A): High (A) - System can be taken offline

**Plain English Explanation:**
This vulnerability allows an attacker on the internet to execute arbitrary code
on the Nextcloud server without needing to log in. The attacker can:
- Read all files stored in Nextcloud
- Modify or delete files
- Take over user accounts
- Potentially compromise the entire server

**Affected Component:** Nextcloud server version 29.0.0
**Package:** nextcloud/core
**Fixed Version:** 29.0.5
```

**Helpful tip:** The CVSS calculator on NVD explains what each component means. You can also use https://www.first.org/cvss/calculator/3.1 to understand scores.

---

### PHASE 4: Develop Remediation Plan (60-90 minutes)

#### Task 10: Identify Patches and Upgrade Paths
**What to do:**
For each critical CVE, determine:

1. **Is there a patch available?**
   - Check the CVE details on NVD
   - Look at the "References" section for vendor advisories
   - Check Nextcloud security advisories: https://nextcloud.com/security/advisories/

2. **What's the recommended upgrade path?**
   - Document which version fixes the vulnerability
   - Note if it's a minor version upgrade (29.0.0 → 29.0.5) or major (29 → 30)
   - Check for breaking changes in release notes

3. **Create an upgrade matrix:**

```markdown
## Remediation Matrix

| CVE ID | Affected Component | Current Version | Fixed Version | Upgrade Type | Breaking Changes? |
|--------|-------------------|-----------------|---------------|--------------|-------------------|
| CVE-2024-1234 | Nextcloud | 29.0.0 | 29.0.5 | Minor patch | No |
| CVE-2024-5678 | PHP | 8.1.2 | 8.1.27 | Security patch | No |
| CVE-2023-9999 | OpenSSL | 3.0.2 | 3.0.12 | Security patch | No |
| CVE-2024-4444 | nginx | 1.25.0 | 1.25.3 | Minor version | No |
| CVE-2023-7777 | MariaDB | 11.0.2 | 11.0.4 | Patch | No |
```

**For Docker images:**
- Check Docker Hub for updated image tags
- Example: `nextcloud:29-apache` → `nextcloud:29.0.5-apache`

---

#### Task 11: Document Temporary Mitigations
**What to do:**
Some CVEs might not have patches yet, or upgrading might break your system. For these, document workarounds:

**Common temporary mitigations:**

1. **Network-based protection:**
   - Restrict access with firewall rules
   - Example: "Block external access to port 8080, only allow traffic through nginx proxy on 443"

2. **Configuration changes:**
   - Disable vulnerable features
   - Example: "Disable XML external entity processing in PHP config"

3. **Web Application Firewall (WAF) rules:**
   - Block known exploit patterns
   - Example: "Add ModSecurity rule to block SQL injection attempts"

4. **Compensating controls:**
   - Extra monitoring or alerting
   - Example: "Enable audit logging for all file uploads to detect exploitation attempts"

**Document like this:**
```markdown
## Temporary Mitigations (When Patching Not Immediately Possible)

### CVE-2024-1234: RCE in File Upload
**Why we can't patch immediately:** Nextcloud 29.0.5 has breaking changes in app API

**Temporary mitigation:**
1. Restrict file upload size to 10MB in nginx config:
   ```nginx
   client_max_body_size 10M;
   ```

2. Implement WAF rule to block payloads containing PHP code:
   ```
   SecRule FILES "\.php$" "id:1001,deny,status:403"
   ```

3. Enable file upload audit logging in Nextcloud admin settings

4. Monitor logs for suspicious file upload activity

**Risk level with mitigation:** MEDIUM (reduced from CRITICAL)
**Timeline for patching:** Planned for Week 6 during hardening phase
```

---

#### Task 12: Create Remediation Priority Matrix
**What to do:**
Organize your remediation plan by priority:

1. **Priority 1 (Fix Immediately):**
   - CRITICAL severity (9.0-10.0)
   - Publicly exploited vulnerabilities
   - Network-accessible components
   - Example: CVEs in nginx proxy, Nextcloud web interface

2. **Priority 2 (Fix This Week):**
   - HIGH severity (7.0-8.9)
   - Requires authentication but still dangerous
   - Database vulnerabilities
   - Example: CVEs in MariaDB, authenticated Nextcloud features

3. **Priority 3 (Fix During Scheduled Maintenance):**
   - MEDIUM severity (4.0-6.9)
   - Requires special conditions to exploit
   - Low impact on confidentiality/integrity/availability
   - Example: Local privilege escalation, information disclosure

4. **Priority 4 (Monitor for Updates):**
   - LOW severity (0.1-3.9)
   - Theoretical vulnerabilities
   - Requires physical access
   - Example: Denial of service requiring local access

**Create a table:**
```markdown
## Remediation Priority Plan

### Priority 1: Fix Immediately (Within 24-48 hours)
| CVE ID | Component | CVSS | Remediation | Estimated Effort |
|--------|-----------|------|-------------|------------------|
| CVE-2024-1234 | Nextcloud | 9.8 | Upgrade to 29.0.5 | 2 hours |
| CVE-2024-5678 | PHP | 9.1 | Update base image | 1 hour |

**Total P1 Items:** 2
**Total Estimated Time:** 3 hours

### Priority 2: Fix This Week
| CVE ID | Component | CVSS | Remediation | Estimated Effort |
|--------|-----------|------|-------------|------------------|
| CVE-2023-9999 | OpenSSL | 8.8 | Update Debian packages | 30 min |
| CVE-2024-4444 | nginx | 8.6 | Upgrade to nginx:1.25.3-alpine | 1 hour |

**Total P2 Items:** 2
**Total Estimated Time:** 1.5 hours

### Priority 3: Fix During Scheduled Maintenance
[... continue for all CVEs ...]

### Priority 4: Monitor Only
[... list low-severity items ...]
```

---

### PHASE 5: Documentation (30-60 minutes)

#### Task 13: Write Comprehensive Findings Report
**What to do:**
Create your Week 5 findings document:

```bash
nano /home/Jason/Team-7-nextcloud-security-lab/docs/findings/week-5-findings.md
```

**Required sections:**

1. **Executive Summary**
   - Total CVEs found
   - Severity breakdown
   - Most critical findings (top 3-5)
   - Overall risk assessment

2. **Methodology**
   - Tools used (Trivy, Composer, Dependency-Check)
   - Scan dates and times
   - Scope of analysis

3. **Detailed Findings**
   - Top 10-15 CVEs with full CVSS breakdown
   - Explanation of each vulnerability in plain language
   - Real-world impact scenarios

4. **Risk Analysis**
   - Which CVEs pose the greatest risk to YOUR environment
   - Contextual factors (is your Nextcloud internet-facing? who has access?)
   - Likelihood of exploitation vs. impact

5. **Remediation Recommendations**
   - Priority matrix
   - Specific upgrade commands
   - Temporary mitigations
   - Testing plan before deploying patches

6. **Appendices**
   - Full CVE list
   - Scan tool outputs
   - References and resources

**Example structure:**
```markdown
# Week 5 Findings: CVE Mapping & Remediation

**Date:** 2025-11-18
**Analyst:** [Your Name]
**Scope:** Nextcloud 29-apache Docker stack (app, db, proxy containers)

## Executive Summary

This vulnerability assessment identified **182 unique CVEs** across the Nextcloud
Docker stack, including **3 CRITICAL** and **34 HIGH** severity vulnerabilities.

**Key Findings:**
- Critical remote code execution vulnerability in Nextcloud (CVE-2024-1234, CVSS 9.8)
- PHP interpreter vulnerabilities allowing arbitrary code execution
- Outdated OpenSSL libraries with known exploits
- Multiple HIGH-severity issues in MariaDB and nginx components

**Risk Assessment:** HIGH
The current Nextcloud deployment has multiple attack vectors that could lead to
complete system compromise if exploited.

**Recommendation:** Immediate patching required for CRITICAL and HIGH findings
before production deployment.

---

## Methodology

### Tools Used
1. **Trivy v0.48.0** - Container image vulnerability scanner
2. **Composer audit** - PHP dependency security checker
3. **OWASP Dependency-Check v9.0.0** - Software composition analysis

### Scan Details
- Scan Date: November 18, 2025
- Containers Scanned:
  - nextcloud:29-apache
  - mariadb:11
  - nginx:alpine
- Vulnerability Databases:
  - NVD (National Vulnerability Database)
  - GitHub Security Advisories
  - Packagist Security Advisories (PHP)

### Analysis Scope
This assessment focuses on:
- Operating system package vulnerabilities
- Application library vulnerabilities (PHP, JavaScript)
- Container base image vulnerabilities
- Direct and transitive dependencies

Out of scope:
- Custom code vulnerabilities (covered in Week 3-4)
- Configuration weaknesses (covered in Week 2)
- Network infrastructure vulnerabilities

---

## Detailed Findings

### CRITICAL Severity (CVSS 9.0-10.0)

#### CVE-2024-1234: Remote Code Execution in Nextcloud File Upload
[... detailed analysis from Task 9 ...]

#### CVE-2024-5678: PHP Interpreter Buffer Overflow
[... detailed analysis ...]

### HIGH Severity (CVSS 7.0-8.9)

[... continue for all priority CVEs ...]

---

## Risk Analysis

### Exploitability Assessment

**Most Exploitable Vulnerabilities:**
1. CVE-2024-1234 (Nextcloud RCE) - Public exploit available, no authentication required
2. CVE-2024-5678 (PHP RCE) - Well-documented attack technique
3. CVE-2023-9999 (OpenSSL) - Active exploitation in the wild

**Contextual Risk Factors:**
- Nextcloud currently exposed on port 8080 (HTTP) and 443 (HTTPS)
- Lab environment accessible from local network (10.0.0.0/24)
- No Web Application Firewall (WAF) in place
- Default Nextcloud configurations may enable vulnerable features

### Impact Analysis

**Worst-Case Scenario:**
An attacker exploiting CVE-2024-1234 could:
1. Gain shell access to the Nextcloud container
2. Read all files uploaded by users
3. Steal database credentials from environment variables
4. Pivot to MariaDB container via Docker network
5. Extract all user credentials and sensitive data

**Business Impact:**
- Confidentiality: Complete compromise of all stored files
- Integrity: Attacker can modify or delete files
- Availability: System could be rendered inoperable
- Compliance: GDPR/HIPAA violations if user data exposed

---

## Remediation Recommendations

### Immediate Actions (Priority 1)

#### 1. Upgrade Nextcloud to Patched Version
**Current:** nextcloud:29-apache (29.0.0)
**Target:** nextcloud:29.0.5-apache

**Commands:**
```bash
cd /home/Jason/Team-7-nextcloud-security-lab/infra/docker

# Update docker-compose.yml to specify patched version
sed -i 's/image: nextcloud:29-apache/image: nextcloud:29.0.5-apache/' docker-compose.yml

# Pull new image and recreate container
docker-compose pull app
docker-compose up -d app
```

**Testing:**
1. Verify application starts: `docker-compose logs app`
2. Test login at https://10.0.0.47
3. Upload test file to verify functionality
4. Re-scan with Trivy to confirm CVE-2024-1234 resolved

**Estimated Time:** 2 hours
**Rollback Plan:** Keep old image, revert docker-compose.yml if issues occur

---

#### 2. Update PHP Base Image
[... detailed remediation steps ...]

---

### This Week (Priority 2)
[... continue with all Priority 2 remediations ...]

---

### Temporary Mitigations
[... from Task 11 ...]

---

### Long-Term Recommendations

1. **Implement Automated Vulnerability Scanning**
   - Schedule weekly Trivy scans
   - Set up alerts for new CRITICAL/HIGH CVEs
   - Integrate with CI/CD pipeline

2. **Establish Patch Management Process**
   - Monthly security update schedule
   - Emergency patching procedure for CRITICAL findings
   - Testing protocol before production deployment

3. **Defense in Depth**
   - Deploy Web Application Firewall (ModSecurity)
   - Implement network segmentation
   - Enable audit logging and SIEM monitoring
   - Regular security assessments (quarterly)

---

## Appendices

### Appendix A: Complete CVE List
[... table with all 182 CVEs ...]

### Appendix B: Scan Tool Outputs
- Trivy scans: `/docs/evidence/week5/trivy-scans/`
- Composer audit: `/docs/evidence/week5/composer-audit/`
- Dependency-Check: `/docs/evidence/week5/dependency-check/`

### Appendix C: References
- National Vulnerability Database: https://nvd.nist.gov/
- Nextcloud Security: https://nextcloud.com/security/
- CVSS Calculator: https://www.first.org/cvss/calculator/3.1
- OWASP Dependency-Check: https://owasp.org/www-project-dependency-check/

### Appendix D: Tool Versions
- Trivy: 0.48.0
- Composer: 2.6.5
- OWASP Dependency-Check: 9.0.0
- Docker: 24.0.7
```

---

#### Task 14: Organize Evidence Files
**What to do:**
Make sure all your evidence is properly organized and documented:

```bash
cd /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5

# Verify all scan outputs are present
ls -lh trivy-scans/
ls -lh composer-audit/
ls -lh dependency-check/

# Create a README explaining what's in each directory
nano README.md
```

**README.md content:**
```markdown
# Week 5 Evidence: CVE Mapping & Remediation

## Directory Structure

### trivy-scans/
Container image vulnerability scans using Aqua Security Trivy.

Files:
- nextcloud-app-trivy.json - JSON output for Nextcloud container
- nextcloud-app-trivy.txt - Human-readable table format
- mariadb-trivy.json - JSON output for MariaDB container
- mariadb-trivy.txt - Human-readable table format
- nginx-trivy.json - JSON output for nginx container
- nginx-trivy.txt - Human-readable table format

### composer-audit/
PHP dependency security audit using Composer.

Files:
- composer-audit.json - JSON output of Composer security advisories
- composer-audit.txt - Human-readable table format

### dependency-check/
Comprehensive Software Composition Analysis using OWASP Dependency-Check.

Files:
- dependency-check-report.html - Interactive HTML report (open in browser)
- dependency-check-report.json - Machine-readable JSON
- dependency-check-report.xml - XML output

### cve-research/
Detailed research notes on individual CVEs.

Files:
- top-cves.txt - Shortlist of 10-15 most critical CVEs
- cve-summary.txt - Overall summary statistics
- cvss-breakdown-notes.md - CVSS scoring explanations

## How to Use This Evidence

1. Start with cve-summary.txt for an overview
2. Review top-cves.txt for the critical findings
3. Open HTML report in browser for interactive exploration
4. Reference JSON files for detailed CVE data
5. See ../findings/week-5-findings.md for complete analysis
```

---

#### Task 15: Final Verification Checklist
**What to do:**
Before considering Week 5 complete, verify:

```markdown
## Week 5 Completion Checklist

- [ ] Nextcloud stack is running
- [ ] Trivy scans completed for all 3 containers (app, db, proxy)
- [ ] Composer audit completed (or documented why skipped)
- [ ] OWASP Dependency-Check run (optional)
- [ ] CVE summary created with total counts and severity breakdown
- [ ] Top 10-15 critical CVEs identified
- [ ] Each critical CVE researched with CVSS breakdown
- [ ] Remediation plan created with priority matrix
- [ ] Temporary mitigations documented
- [ ] week-5-findings.md written with all required sections
- [ ] All scan outputs saved to docs/evidence/week5/
- [ ] Evidence directory has README.md explaining contents
- [ ] File paths are absolute and properly referenced in findings
- [ ] Screenshots or snippets included in findings for key vulnerabilities
- [ ] Remediation commands tested (or clearly marked as "to be tested in Week 6")

## Files That Should Exist

Evidence:
- /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/trivy-scans/nextcloud-app-trivy.json
- /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/trivy-scans/nextcloud-app-trivy.txt
- /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/trivy-scans/mariadb-trivy.json
- /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/trivy-scans/mariadb-trivy.txt
- /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/trivy-scans/nginx-trivy.json
- /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/trivy-scans/nginx-trivy.txt
- /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/composer-audit/composer-audit.json
- /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/composer-audit/composer-audit.txt
- /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/cve-research/top-cves.txt
- /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/cve-research/cve-summary.txt
- /home/Jason/Team-7-nextcloud-security-lab/docs/evidence/week5/README.md

Findings:
- /home/Jason/Team-7-nextcloud-security-lab/docs/findings/week-5-findings.md
```

---

## Understanding CVSS Scores (Quick Reference)

### CVSS Score Ranges
- **0.0**: No vulnerability
- **0.1-3.9**: LOW severity - Minimal impact
- **4.0-6.9**: MEDIUM severity - Some impact, harder to exploit
- **7.0-8.9**: HIGH severity - Significant impact, relatively easy to exploit
- **9.0-10.0**: CRITICAL severity - Severe impact, easy to exploit

### CVSS Metrics Explained Simply

**Attack Vector (AV):**
- Network (N) - "Can be attacked from anywhere on the internet"
- Adjacent (A) - "Attacker must be on same WiFi/network"
- Local (L) - "Attacker must have local computer access"
- Physical (P) - "Attacker must physically touch the server"

**Attack Complexity (AC):**
- Low (L) - "Easy to exploit, works every time"
- High (H) - "Hard to exploit, needs special conditions or luck"

**Privileges Required (PR):**
- None (N) - "No login needed, anyone can attack"
- Low (L) - "Need a basic user account"
- High (H) - "Need admin privileges"

**User Interaction (UI):**
- None (N) - "Fully automatic attack"
- Required (R) - "User must click link, open file, etc."

**Impact (C/I/A):**
- High (H) - "Complete compromise"
- Low (L) - "Some data affected"
- None (N) - "No impact on this aspect"

**Example Scenarios:**

1. **CVSS 9.8 - Worst Case**
   - AV:N AC:L PR:N UI:N = "Anyone on internet can easily exploit without logging in"
   - C:H I:H A:H = "Can read, modify, and destroy everything"

2. **CVSS 6.5 - Medium Risk**
   - AV:N AC:L PR:L UI:N = "Requires login but then easy to exploit"
   - C:H I:N A:N = "Can only read data, not modify or destroy"

3. **CVSS 3.3 - Low Risk**
   - AV:L AC:L PR:L UI:R = "Requires local access, login, and user interaction"
   - C:L I:N A:N = "Can only read small amount of data"

---

## Common Pitfalls and Troubleshooting

### Problem: Trivy scan shows 0 vulnerabilities
**Solution:** This likely means Trivy's database isn't updated. Run:
```bash
trivy image --download-db-only
```
Then re-run your scans.

### Problem: Composer command not found in container
**Solution:** The Nextcloud image might not include Composer. This is OK - document it in your findings as a limitation. Trivy will still catch PHP library CVEs.

### Problem: OWASP Dependency-Check takes forever
**Solution:** First run downloads entire NVD database (20+ GB). This is normal. Subsequent runs are much faster. Consider running overnight or skipping if time-constrained.

### Problem: Too many CVEs to analyze
**Solution:** You don't need to analyze ALL CVEs. Focus on:
1. CRITICAL severity only (usually 0-10 CVEs)
2. HIGH severity in Nextcloud app component
3. Any with "EXPLOIT AVAILABLE" notation

Acknowledge the others exist but note they're lower priority.

### Problem: Can't find CVSS breakdown in scan output
**Solution:**
1. Check the JSON output files - they have more detail
2. Look up the CVE on https://nvd.nist.gov/vuln/search
3. Use the NVD's built-in CVSS calculator for explanations

### Problem: Unclear which version fixes a CVE
**Solution:**
1. Check NVD references section for vendor advisories
2. Google "[Package Name] [CVE ID] fix version"
3. Check GitHub security advisories
4. If still unclear, note "Patch status unknown" in findings

---

## Time Estimates

**Total Week 5 Time: 6-8 hours**

Breakdown:
- Phase 1 (Preparation): 15 minutes
- Phase 2 (Scans): 45-60 minutes
- Phase 3 (Analysis): 60-90 minutes
- Phase 4 (Remediation Planning): 60-90 minutes
- Phase 5 (Documentation): 30-60 minutes
- Buffer for troubleshooting: 30-60 minutes

Can be split across multiple sessions:
- Session 1: Run all scans (1 hour)
- Session 2: Analyze results and research CVEs (2 hours)
- Session 3: Create remediation plan and document (2-3 hours)

---

## Next Steps (Week 6 Preview)

Week 6 will involve:
1. Actually implementing your remediation plan
2. Rebuilding containers with patched versions
3. Re-scanning to verify CVEs are fixed
4. Creating a hardened docker-compose.yml
5. Documenting before/after comparison
6. Writing final project report

Your Week 5 remediation plan becomes Week 6's implementation guide!

---

## Additional Resources

**CVE Databases:**
- National Vulnerability Database: https://nvd.nist.gov/
- MITRE CVE List: https://cve.mitre.org/
- GitHub Advisory Database: https://github.com/advisories

**CVSS Resources:**
- CVSS v3.1 Calculator: https://www.first.org/cvss/calculator/3.1
- CVSS Specification: https://www.first.org/cvss/v3.1/specification-document
- CVSS User Guide: https://www.first.org/cvss/user-guide

**Nextcloud Security:**
- Nextcloud Security Advisories: https://nextcloud.com/security/advisories/
- Nextcloud Hardening Guide: https://docs.nextcloud.com/server/latest/admin_manual/installation/harden_server.html

**Tool Documentation:**
- Trivy: https://aquasecurity.github.io/trivy/
- OWASP Dependency-Check: https://owasp.org/www-project-dependency-check/
- Composer Security: https://getcomposer.org/doc/04-schema.md#security

---

**Good luck with Week 5! Remember: Finding lots of vulnerabilities is expected and demonstrates thoroughness. Focus on understanding the critical ones and proposing realistic fixes.**
